(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill;var objectKeys=Object.keys||objectKeysPolyfill;var bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events")){this._events=objectCreate(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;var hasDefineProperty;try{var o={};if(Object.defineProperty)Object.defineProperty(o,"x",{value:0});hasDefineProperty=o.x===0}catch(err){hasDefineProperty=false}if(hasDefineProperty){Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||arg!==arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}})}else{EventEmitter.defaultMaxListeners=defaultMaxListeners}EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn)handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self)}}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1)}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].apply(self,args)}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events;var doError=type==="error";events=this._events;if(events)doError=doError&&events.error==null;else if(!doError)return false;if(doError){if(arguments.length>1)er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Unhandled "error" event. ('+er+")");err.context=er;throw err}return false}handler=events[type];if(!handler)return false;var isFn=typeof handler==="function";len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=objectCreate(null);target._eventsCount=0}else{if(events.newListener){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners '+"added. Use emitter.setMaxListeners() to "+"increase limit.");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;if(typeof console==="object"&&console.warn){console.warn("%s: %s",w.name,w.message)}}}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:var args=new Array(arguments.length);for(var i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=bind.call(onceWrapper,state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)return this;list=events[type];if(!list)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=objectCreate(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else spliceOne(list,position);if(list.length===1)events[type]=list[0];if(events.removeListener)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(!events)return this;if(!events.removeListener){if(arguments.length===0){this._events=objectCreate(null);this._eventsCount=0}else if(events[type]){if(--this._eventsCount===0)this._events=objectCreate(null);else delete events[type]}return this}if(arguments.length===0){var keys=objectKeys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=objectCreate(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];if(!evlistener)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)copy[i]=arr[i];return copy}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function objectCreatePolyfill(proto){var F=function(){};F.prototype=proto;return new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj)if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k)}return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}},{}],2:[function(require,module,exports){CanvasRenderingContext2D.prototype.storeLoadedImage=function(key,image){if(!this.images){this.images={}}this.images[key]=image};CanvasRenderingContext2D.prototype.getLoadedImage=function(key){if(this.images[key]){return this.images[key]}};CanvasRenderingContext2D.prototype.followSprite=function(sprite){this.centralSprite=sprite};CanvasRenderingContext2D.prototype.getCentralPosition=function(){return{map:this.centralSprite.mapPosition,canvas:[Math.round(this.canvas.width*.5),Math.round(this.canvas.height*.5),0]}};CanvasRenderingContext2D.prototype.mapPositionToCanvasPosition=function(position){var central=this.getCentralPosition();var centralMapPosition=central.map;var centralCanvasPosition=central.canvas;var mapDifferenceX=centralMapPosition[0]-position[0];var mapDifferenceY=centralMapPosition[1]-position[1];return[centralCanvasPosition[0]-mapDifferenceX,centralCanvasPosition[1]-mapDifferenceY]};CanvasRenderingContext2D.prototype.canvasPositionToMapPosition=function(position){var central=this.getCentralPosition();var centralMapPosition=central.map;var centralCanvasPosition=central.canvas;var mapDifferenceX=centralCanvasPosition[0]-position[0];var mapDifferenceY=centralCanvasPosition[1]-position[1];return[centralMapPosition[0]-mapDifferenceX,centralMapPosition[1]-mapDifferenceY]};CanvasRenderingContext2D.prototype.getCentreOfViewport=function(){return(this.canvas.width/2).floor()};CanvasRenderingContext2D.prototype.getMiddleOfViewport=function(){return(this.canvas.height/2).floor()};CanvasRenderingContext2D.prototype.getBelowViewport=function(){return this.canvas.height.floor()};CanvasRenderingContext2D.prototype.getMapBelowViewport=function(){var below=this.getBelowViewport();return this.canvasPositionToMapPosition([0,below])[1]};CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfCanvas=function(buffer){var min=0;var max=this.canvas.width;if(buffer){min-=buffer;max+=buffer}return Number.random(min,max)};CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfMap=function(buffer){var random=this.getRandomlyInTheCentreOfCanvas(buffer);return this.canvasPositionToMapPosition([random,0])[0]};CanvasRenderingContext2D.prototype.getRandomMapPositionBelowViewport=function(){var xCanvas=this.getRandomlyInTheCentreOfCanvas();var yCanvas=this.getBelowViewport();return this.canvasPositionToMapPosition([xCanvas,yCanvas])};CanvasRenderingContext2D.prototype.getRandomMapPositionAboveViewport=function(){var xCanvas=this.getRandomlyInTheCentreOfCanvas();var yCanvas=this.getAboveViewport();return this.canvasPositionToMapPosition([xCanvas,yCanvas])};CanvasRenderingContext2D.prototype.getTopOfViewport=function(){return this.canvasPositionToMapPosition([0,0])[1]};CanvasRenderingContext2D.prototype.getAboveViewport=function(){return 0-(this.canvas.height/4).floor()}},{}],3:[function(require,module,exports){Function.prototype.method=function(name,func){this.prototype[name]=func;return this};Object.method("superior",function(name){var that=this;var method=that[name];return function(){return method.apply(that,arguments)}})},{}],4:[function(require,module,exports){var SpriteArray=require("./spriteArray");var EventedLoop=require("eventedloop");(function(global){function Game(mainCanvas,player){var staticObjects=new SpriteArray;var movingObjects=new SpriteArray;var uiElements=new SpriteArray;var dContext=mainCanvas.getContext("2d");var mouseX=dContext.getCentreOfViewport();var mouseY=0;var paused=false;var that=this;var beforeCycleCallbacks=[];var afterCycleCallbacks=[];var gameLoop=new EventedLoop;this.addStaticObject=function(sprite){staticObjects.push(sprite)};this.addStaticObjects=function(sprites){sprites.forEach(this.addStaticObject.bind(this))};this.addMovingObject=function(movingObject,movingObjectType){if(movingObjectType){staticObjects.onPush(function(obj){if(obj.data&&obj.data.hitBehaviour[movingObjectType]){obj.onHitting(movingObject,obj.data.hitBehaviour[movingObjectType])}},true)}movingObjects.push(movingObject)};this.addUIElement=function(element){uiElements.push(element)};this.beforeCycle=function(callback){beforeCycleCallbacks.push(callback)};this.afterCycle=function(callback){afterCycleCallbacks.push(callback)};this.setMouseX=function(x){mouseX=x};this.setMouseY=function(y){mouseY=y};player.setMapPosition(0,0);player.setMapPositionTarget(0,-10);dContext.followSprite(player);var intervalNum=0;this.cycle=function(){beforeCycleCallbacks.each(function(c){c()});var mouseMapPosition=dContext.canvasPositionToMapPosition([mouseX,mouseY]);intervalNum++;player.cycle();movingObjects.each(function(movingObject,i){movingObject.cycle(dContext)});staticObjects.cull();staticObjects.each(function(staticObject,i){if(staticObject.cycle){staticObject.cycle()}});uiElements.each(function(uiElement,i){if(uiElement.cycle){uiElement.cycle()}});afterCycleCallbacks.each(function(c){c()})};that.draw=function(){mainCanvas.width=mainCanvas.width;player.draw(dContext);player.cycle();movingObjects.each(function(movingObject,i){movingObject.draw(dContext)});staticObjects.each(function(staticObject,i){if(staticObject.draw){staticObject.draw(dContext,"main")}});uiElements.each(function(uiElement,i){if(uiElement.draw){uiElement.draw(dContext,"main")}})};this.start=function(){gameLoop.start()};this.pause=function(){paused=true;gameLoop.stop()};this.isPaused=function(){return paused};this.reset=function(){paused=false;staticObjects=new SpriteArray;movingObjects=new SpriteArray;mouseX=dContext.getCentreOfViewport();mouseY=0;player.reset();player.setMapPosition(0,0,0);this.start()}.bind(this);gameLoop.on("20",this.cycle);gameLoop.on("20",this.draw)}global.game=Game})(this);if(typeof module!=="undefined"){module.exports=this.game}},{"./spriteArray":13,eventedloop:17}],5:[function(require,module,exports){(function(global){function guid(){var S4=function(){return Math.floor(Math.random()*65536).toString(16)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}global.guid=guid})(this);if(typeof module!=="undefined"){module.exports=this.guid}},{}],6:[function(require,module,exports){function InfoBox(data){var that=this;that.lines=data.initialLines;that.top=data.position.top;that.right=data.position.right;that.bottom=data.position.bottom;that.left=data.position.left;that.width=data.width;that.height=data.height;that.setLines=function(lines){that.lines=lines};that.draw=function(dContext){dContext.font="11px monospace";var yOffset=0;that.lines.each(function(line){var fontSize=+dContext.font.slice(0,2);var textWidth=dContext.measureText(line).width;var textHeight=fontSize*1.5;var xPos,yPos;if(that.top){yPos=that.top+yOffset}else if(that.bottom){yPos=dContext.canvas.height-that.top-textHeight+yOffset}if(that.right){xPos=dContext.canvas.width-that.right-textWidth}else if(that.left){xPos=that.left}yOffset+=textHeight;dContext.fillText(line,xPos,yPos)})};return that}if(typeof module!=="undefined"){module.exports=InfoBox}},{}],7:[function(require,module,exports){function isMobileDevice(){if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)){return true}else{return false}}module.exports=isMobileDevice},{}],8:[function(require,module,exports){var Sprite=require("./sprite");(function(global){function Monster(data){var that=new Sprite(data);var super_draw=that.superior("draw");var spriteVersion=1;var eatingStage=0;var standardSpeed=6;that.isEating=false;that.isFull=false;that.setSpeed(standardSpeed);that.draw=function(dContext){var spritePartToUse=function(){var xDiff=that.movingToward[0]-that.canvasX;if(that.isEating){return"eating"+eatingStage}if(spriteVersion+.1>2){spriteVersion=.1}else{spriteVersion+=.1}if(xDiff>=0){return"sEast"+Math.ceil(spriteVersion)}else if(xDiff<0){return"sWest"+Math.ceil(spriteVersion)}};return super_draw(dContext,spritePartToUse())};function startEating(whenDone){eatingStage+=1;that.isEating=true;that.isMoving=false;if(eatingStage<6){setTimeout(function(){startEating(whenDone)},300)}else{eatingStage=0;that.isEating=false;that.isMoving=true;whenDone()}}that.startEating=startEating;return that}global.monster=Monster})(this);if(typeof module!=="undefined"){module.exports=this.monster}},{"./sprite":12}],9:[function(require,module,exports){(function(){var method;var noop=function noop(){};var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var length=methods.length;var console=window.console=window.console||{};while(length--){method=methods[length];if(!console[method]){console[method]=noop}}})()},{}],10:[function(require,module,exports){var Sprite=require("./sprite");if(typeof navigator!=="undefined"){navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate}else{navigator={vibrate:false}}(function(global){function Skier(data){var discreteDirections={west:270,wsWest:240,sWest:195,south:180,sEast:165,esEast:120,east:90};var that=new Sprite(data);var sup={draw:that.superior("draw"),cycle:that.superior("cycle"),getSpeedX:that.superior("getSpeedX"),getSpeedY:that.superior("getSpeedY"),hits:that.superior("hits")};var directions={esEast:function(xDiff){return xDiff>300},sEast:function(xDiff){return xDiff>75},wsWest:function(xDiff){return xDiff<-300},sWest:function(xDiff){return xDiff<-75}};var cancelableStateTimeout;var cancelableStateInterval;var canSpeedBoost=true;var obstaclesHit=[];var pixelsTravelled=0;var standardSpeed=5;var boostMultiplier=2;var turnEaseCycles=70;var speedX=0;var speedXFactor=0;var speedY=0;var speedYFactor=1;var trickStep=0;that.isMoving=true;that.hasBeenHit=false;that.isJumping=false;that.isPerformingTrick=false;that.onHitObstacleCb=function(){};that.setSpeed(standardSpeed);that.reset=function(){obstaclesHit=[];pixelsTravelled=0;that.isMoving=true;that.hasBeenHit=false;canSpeedBoost=true;setNormal()};function setNormal(){that.setSpeed(standardSpeed);that.isMoving=true;that.hasBeenHit=false;that.isJumping=false;that.isPerformingTrick=false;if(cancelableStateInterval){clearInterval(cancelableStateInterval)}that.setMapPosition(undefined,undefined,0)}function setCrashed(){that.isMoving=false;that.hasBeenHit=true;that.isJumping=false;that.isPerformingTrick=false;if(cancelableStateInterval){clearInterval(cancelableStateInterval)}that.setMapPosition(undefined,undefined,0)}function setJumping(){var currentSpeed=that.getSpeed();that.setSpeed(currentSpeed+2);that.setSpeedY(currentSpeed+2);that.isMoving=true;that.hasBeenHit=false;that.isJumping=true;that.setMapPosition(undefined,undefined,1)}function getDiscreteDirection(){if(that.direction){if(that.direction<=90){return"east"}else if(that.direction>90&&that.direction<150){return"esEast"}else if(that.direction>=150&&that.direction<180){return"sEast"}else if(that.direction===180){return"south"}else if(that.direction>180&&that.direction<=210){return"sWest"}else if(that.direction>210&&that.direction<270){return"wsWest"}else if(that.direction>=270){return"west"}else{return"south"}}else{var xDiff=that.movingToward[0]-that.mapPosition[0];var yDiff=that.movingToward[1]-that.mapPosition[1];if(yDiff<=0){if(xDiff>0){return"east"}else{return"west"}}if(directions.esEast(xDiff)){return"esEast"}else if(directions.sEast(xDiff)){return"sEast"}else if(directions.wsWest(xDiff)){return"wsWest"}else if(directions.sWest(xDiff)){return"sWest"}}return"south"}function setDiscreteDirection(d){if(discreteDirections[d]){that.setDirection(discreteDirections[d])}if(d==="west"||d==="east"){that.isMoving=false}else{that.isMoving=true}}function getBeingEatenSprite(){return"blank"}function getJumpingSprite(){return"jumping"}function getTrickSprite(){console.log("Trick step is",trickStep);if(trickStep===0){return"jumping"}else if(trickStep===1){return"somersault1"}else{return"somersault2"}}that.stop=function(){if(that.direction>180){setDiscreteDirection("west")}else{setDiscreteDirection("east")}};that.turnEast=function(){var discreteDirection=getDiscreteDirection();switch(discreteDirection){case"west":setDiscreteDirection("wsWest");break;case"wsWest":setDiscreteDirection("sWest");break;case"sWest":setDiscreteDirection("south");break;case"south":setDiscreteDirection("sEast");break;case"sEast":setDiscreteDirection("esEast");break;case"esEast":setDiscreteDirection("east");break;default:setDiscreteDirection("south");break}};that.turnWest=function(){var discreteDirection=getDiscreteDirection();switch(discreteDirection){case"east":setDiscreteDirection("esEast");break;case"esEast":setDiscreteDirection("sEast");break;case"sEast":setDiscreteDirection("south");break;case"south":setDiscreteDirection("sWest");break;case"sWest":setDiscreteDirection("wsWest");break;case"wsWest":setDiscreteDirection("west");break;default:setDiscreteDirection("south");break}};that.stepWest=function(){that.mapPosition[0]-=that.speed*2};that.stepEast=function(){that.mapPosition[0]+=that.speed*2};that.setMapPositionTarget=function(x,y){if(that.hasBeenHit)return;if(Math.abs(that.mapPosition[0]-x)<=75){x=that.mapPosition[0]}that.movingToward=[x,y]};that.startMovingIfPossible=function(){if(!that.hasBeenHit&&!that.isBeingEaten){that.isMoving=true}};that.setTurnEaseCycles=function(c){turnEaseCycles=c};that.getPixelsTravelledDownMountain=function(){return pixelsTravelled};that.resetSpeed=function(){that.setSpeed(standardSpeed)};that.cycle=function(){if(that.getSpeedX()<=0&&that.getSpeedY()<=0){that.isMoving=false}if(that.isMoving){pixelsTravelled+=that.speed}if(that.isJumping){that.setMapPositionTarget(undefined,that.mapPosition[1]+that.getSpeed())}sup.cycle();that.checkHittableObjects()};that.draw=function(dContext){var spritePartToUse=function(){if(that.isBeingEaten){return getBeingEatenSprite()}if(that.isJumping){if(that.isPerformingTrick){return getTrickSprite()}return getJumpingSprite()}if(that.hasBeenHit){return"hit"}return getDiscreteDirection()};return sup.draw(dContext,spritePartToUse())};that.hits=function(obs){if(obstaclesHit.indexOf(obs.id)!==-1){return false}if(!obs.occupiesZIndex(that.mapPosition[2])){return false}if(sup.hits(obs)){return true}return false};that.speedBoost=function(){var originalSpeed=that.speed;if(canSpeedBoost){canSpeedBoost=false;that.setSpeed(that.speed*boostMultiplier);setTimeout(function(){that.setSpeed(originalSpeed);setTimeout(function(){canSpeedBoost=true},1e4)},2e3)}};that.attemptTrick=function(){if(that.isJumping){that.isPerformingTrick=true;cancelableStateInterval=setInterval(function(){if(trickStep>=2){trickStep=0}else{trickStep+=1}},300)}};that.getStandardSpeed=function(){return standardSpeed};function easeSpeedToTargetUsingFactor(sp,targetSpeed,f){if(f===0||f===1){return targetSpeed}if(sp<targetSpeed){sp+=that.getSpeed()*(f/turnEaseCycles)}if(sp>targetSpeed){sp-=that.getSpeed()*(f/turnEaseCycles)}return sp}that.getSpeedX=function(){if(getDiscreteDirection()==="esEast"||getDiscreteDirection()==="wsWest"){speedXFactor=.5;speedX=easeSpeedToTargetUsingFactor(speedX,that.getSpeed()*speedXFactor,speedXFactor);return speedX}if(getDiscreteDirection()==="sEast"||getDiscreteDirection()==="sWest"){speedXFactor=.33;speedX=easeSpeedToTargetUsingFactor(speedX,that.getSpeed()*speedXFactor,speedXFactor);return speedX}speedX=easeSpeedToTargetUsingFactor(speedX,0,speedXFactor);return speedX};that.setSpeedY=function(sy){speedY=sy};that.getSpeedY=function(){var targetSpeed;if(that.isJumping){return speedY}if(getDiscreteDirection()==="esEast"||getDiscreteDirection()==="wsWest"){speedYFactor=.6;speedY=easeSpeedToTargetUsingFactor(speedY,that.getSpeed()*.6,.6);return speedY}if(getDiscreteDirection()==="sEast"||getDiscreteDirection()==="sWest"){speedYFactor=.85;speedY=easeSpeedToTargetUsingFactor(speedY,that.getSpeed()*.85,.85);return speedY}if(getDiscreteDirection()==="east"||getDiscreteDirection()==="west"){speedYFactor=1;speedY=0;return speedY}speedY=easeSpeedToTargetUsingFactor(speedY,that.getSpeed(),speedYFactor);return speedY};that.hasHitObstacle=function(obs){setCrashed();if(navigator.vibrate){navigator.vibrate(500)}obstaclesHit.push(obs.id);that.resetSpeed();that.onHitObstacleCb(obs);if(cancelableStateTimeout){clearTimeout(cancelableStateTimeout)}cancelableStateTimeout=setTimeout(function(){setNormal()},1500)};that.hasHitJump=function(){setJumping();if(cancelableStateTimeout){clearTimeout(cancelableStateTimeout)}cancelableStateTimeout=setTimeout(function(){setNormal()},1e3)};that.isEatenBy=function(monster,whenEaten){that.hasHitObstacle(monster);monster.startEating(whenEaten);obstaclesHit.push(monster.id);that.isMoving=false;that.isBeingEaten=true};that.reset=function(){obstaclesHit=[];pixelsTravelled=0;that.isMoving=true;that.isJumping=false;that.hasBeenHit=false;canSpeedBoost=true};that.setHitObstacleCb=function(fn){that.onHitObstacleCb=fn||function(){}};return that}global.skier=Skier})(this);if(typeof module!=="undefined"){module.exports=this.skier}},{"./sprite":12}],11:[function(require,module,exports){var Sprite=require("./sprite");(function(global){function Snowboarder(data){var that=new Sprite(data);var sup={draw:that.superior("draw"),cycle:that.superior("cycle")};var directions={sEast:function(xDiff){return xDiff>0},sWest:function(xDiff){return xDiff<=0}};var standardSpeed=3;that.setSpeed(standardSpeed);function getDirection(){var xDiff=that.movingToward[0]-that.mapPosition[0];var yDiff=that.movingToward[1]-that.mapPosition[1];if(directions.sEast(xDiff)){return"sEast"}else{return"sWest"}}that.cycle=function(dContext){if(Number.random(10)===1){that.setMapPositionTarget(dContext.getRandomlyInTheCentreOfMap());that.setSpeed(standardSpeed+Number.random(-1,1))}that.setMapPositionTarget(undefined,dContext.getMapBelowViewport()+600);sup.cycle()};that.draw=function(dContext){var spritePartToUse=function(){return getDirection()};return sup.draw(dContext,spritePartToUse())};return that}global.snowboarder=Snowboarder})(this);if(typeof module!=="undefined"){module.exports=this.snowboarder}},{"./sprite":12}],12:[function(require,module,exports){(function(global){var GUID=require("./guid");function Sprite(data){var hittableObjects={};var zIndexesOccupied=[0];var that=this;var trackedSpriteToMoveToward;that.direction=undefined;that.mapPosition=[0,0,0];that.id=GUID();that.canvasX=0;that.canvasY=0;that.canvasZ=0;that.height=0;that.speed=0;that.data=data||{parts:{}};that.movingToward=[0,0];that.metresDownTheMountain=0;that.movingWithConviction=false;that.deleted=false;that.maxHeight=function(){return Object.values(that.data.parts).map(function(p){return p[3]}).max()}();that.isMoving=true;if(!that.data.parts){that.data.parts={}}if(data&&data.id){that.id=data.id}if(data&&data.zIndexesOccupied){zIndexesOccupied=data.zIndexesOccupied}function incrementX(amount){that.canvasX+=amount.toNumber()}function incrementY(amount){that.canvasY+=amount.toNumber()}function getHitBox(forZIndex){if(that.data.hitBoxes){if(data.hitBoxes[forZIndex]){return data.hitBoxes[forZIndex]}}}function roundHalf(num){num=Math.round(num*2)/2;return num}function move(){if(!that.isMoving){return}var currentX=that.mapPosition[0];var currentY=that.mapPosition[1];if(typeof that.direction!=="undefined"){var d=that.direction-90;if(d<0)d=360+d;currentX+=roundHalf(that.speed*Math.cos(d*(Math.PI/180)));currentY+=roundHalf(that.speed*Math.sin(d*(Math.PI/180)))}else{if(typeof that.movingToward[0]!=="undefined"){if(currentX>that.movingToward[0]){currentX-=Math.min(that.getSpeedX(),Math.abs(currentX-that.movingToward[0]))}else if(currentX<that.movingToward[0]){currentX+=Math.min(that.getSpeedX(),Math.abs(currentX-that.movingToward[0]))}}if(typeof that.movingToward[1]!=="undefined"){if(currentY>that.movingToward[1]){currentY-=Math.min(that.getSpeedY(),Math.abs(currentY-that.movingToward[1]))}else if(currentY<that.movingToward[1]){currentY+=Math.min(that.getSpeedY(),Math.abs(currentY-that.movingToward[1]))}}}that.setMapPosition(currentX,currentY)}this.draw=function(dCtx,spriteFrame){var fr=that.data.parts[spriteFrame];that.height=fr[3];that.width=fr[2];var newCanvasPosition=dCtx.mapPositionToCanvasPosition(that.mapPosition);that.setCanvasPosition(newCanvasPosition[0],newCanvasPosition[1]);dCtx.drawImage(dCtx.getLoadedImage(that.data.$imageFile),fr[0],fr[1],fr[2],fr[3],that.canvasX,that.canvasY,fr[2],fr[3])};this.setMapPosition=function(x,y,z){if(typeof x==="undefined"){x=that.mapPosition[0]}if(typeof y==="undefined"){y=that.mapPosition[1]}if(typeof z==="undefined"){z=that.mapPosition[2]}else{that.zIndexesOccupied=[z]}that.mapPosition=[x,y,z]};this.setCanvasPosition=function(cx,cy){if(cx){if(Object.isString(cx)&&(cx.first()==="+"||cx.first()==="-"))incrementX(cx);else that.canvasX=cx}if(cy){if(Object.isString(cy)&&(cy.first()==="+"||cy.first()==="-"))incrementY(cy);else that.canvasY=cy}};this.getCanvasPositionX=function(){return that.canvasX};this.getCanvasPositionY=function(){return that.canvasY};this.getLeftHitBoxEdge=function(zIndex){zIndex=zIndex||0;var lhbe=this.getCanvasPositionX();if(getHitBox(zIndex)){lhbe+=getHitBox(zIndex)[0]}return lhbe};this.getTopHitBoxEdge=function(zIndex){zIndex=zIndex||0;var thbe=this.getCanvasPositionY();if(getHitBox(zIndex)){thbe+=getHitBox(zIndex)[1]}return thbe};this.getRightHitBoxEdge=function(zIndex){zIndex=zIndex||0;if(getHitBox(zIndex)){return that.canvasX+getHitBox(zIndex)[2]}return that.canvasX+that.width};this.getBottomHitBoxEdge=function(zIndex){zIndex=zIndex||0;if(getHitBox(zIndex)){return that.canvasY+getHitBox(zIndex)[3]}return that.canvasY+that.height};this.getPositionInFrontOf=function(){return[that.canvasX,that.canvasY+that.height]};this.setSpeed=function(s){that.speed=s;that.speedX=s;that.speedY=s};this.incrementSpeedBy=function(s){that.speed+=s};that.getSpeed=function getSpeed(){return that.speed};that.getSpeedX=function(){return that.speed};that.getSpeedY=function(){return that.speed};this.setHeight=function(h){that.height=h};this.setWidth=function(w){that.width=w};this.getMaxHeight=function(){return that.maxHeight};that.getMovingTowardOpposite=function(){if(!that.isMoving){return[0,0]}var dx=that.movingToward[0]-that.mapPosition[0];var dy=that.movingToward[1]-that.mapPosition[1];var oppositeX=Math.abs(dx)>75?0-dx:0;var oppositeY=-dy;return[oppositeX,oppositeY]};this.checkHittableObjects=function(){Object.keys(hittableObjects,function(k,objectData){if(objectData.object.deleted){delete hittableObjects[k]}else{if(objectData.object.hits(that)){objectData.callbacks.each(function(callback){callback(that,objectData.object)})}}})};this.cycle=function(){that.checkHittableObjects();if(trackedSpriteToMoveToward){that.setMapPositionTarget(trackedSpriteToMoveToward.mapPosition[0],trackedSpriteToMoveToward.mapPosition[1],true)}move()};this.setMapPositionTarget=function(x,y,override){if(override){that.movingWithConviction=false}if(!that.movingWithConviction){if(typeof x==="undefined"){x=that.movingToward[0]}if(typeof y==="undefined"){y=that.movingToward[1]}that.movingToward=[x,y];that.movingWithConviction=false}};this.setDirection=function(angle){if(angle>=360){angle=360-angle}that.direction=angle;that.movingToward=undefined};this.resetDirection=function(){that.direction=undefined};this.setMapPositionTargetWithConviction=function(cx,cy){that.setMapPositionTarget(cx,cy);that.movingWithConviction=true};this.follow=function(sprite){trackedSpriteToMoveToward=sprite};this.stopFollowing=function(){trackedSpriteToMoveToward=false};this.onHitting=function(objectToHit,callback){if(hittableObjects[objectToHit.id]){return hittableObjects[objectToHit.id].callbacks.push(callback)}hittableObjects[objectToHit.id]={object:objectToHit,callbacks:[callback]}};this.deleteOnNextCycle=function(){that.deleted=true};this.occupiesZIndex=function(z){return zIndexesOccupied.indexOf(z)>=0};this.hits=function(other){var verticalIntersect=false;var horizontalIntersect=false;if(other.getTopHitBoxEdge(that.mapPosition[2])<=that.getBottomHitBoxEdge(that.mapPosition[2])&&other.getBottomHitBoxEdge(that.mapPosition[2])>=that.getBottomHitBoxEdge(that.mapPosition[2])){verticalIntersect=true}if(other.getTopHitBoxEdge(that.mapPosition[2])<=that.getTopHitBoxEdge(that.mapPosition[2])&&other.getBottomHitBoxEdge(that.mapPosition[2])>=that.getTopHitBoxEdge(that.mapPosition[2])){verticalIntersect=true}if(other.getLeftHitBoxEdge(that.mapPosition[2])<=that.getRightHitBoxEdge(that.mapPosition[2])&&other.getRightHitBoxEdge(that.mapPosition[2])>=that.getRightHitBoxEdge(that.mapPosition[2])){horizontalIntersect=true}if(other.getLeftHitBoxEdge(that.mapPosition[2])<=that.getLeftHitBoxEdge(that.mapPosition[2])&&other.getRightHitBoxEdge(that.mapPosition[2])>=that.getLeftHitBoxEdge(that.mapPosition[2])){horizontalIntersect=true}return verticalIntersect&&horizontalIntersect};this.isAboveOnCanvas=function(cy){return that.canvasY+that.height<cy};this.isBelowOnCanvas=function(cy){return that.canvasY>cy};return that}Sprite.createObjects=function createObjects(spriteInfoArray,opts){if(!Array.isArray(spriteInfoArray))spriteInfoArray=[spriteInfoArray];opts=Object.merge(opts,{rateModifier:0,dropRate:1,position:[0,0]},false,false);function createOne(spriteInfo){var position=opts.position;if(Number.random(100+opts.rateModifier)<=spriteInfo.dropRate){var sprite=new Sprite(spriteInfo.sprite);sprite.setSpeed(0);if(Object.isFunction(position)){position=position()}sprite.setMapPosition(position[0],position[1]);if(spriteInfo.sprite.hitBehaviour&&spriteInfo.sprite.hitBehaviour.skier&&opts.player){sprite.onHitting(opts.player,spriteInfo.sprite.hitBehaviour.skier)}return sprite}}var objects=spriteInfoArray.map(createOne).remove(undefined);return objects};global.sprite=Sprite})(this);if(typeof module!=="undefined"){module.exports=this.sprite}},{"./guid":5}],13:[function(require,module,exports){(function(global){function SpriteArray(){this.pushHandlers=[];return this}SpriteArray.prototype=Object.create(Array.prototype);SpriteArray.prototype.onPush=function(f,retroactive){this.pushHandlers.push(f);if(retroactive){this.each(f)}};SpriteArray.prototype.push=function(obj){Array.prototype.push.call(this,obj);this.pushHandlers.each(function(handler){handler(obj)})};SpriteArray.prototype.cull=function(){this.each(function(obj,i){if(obj.deleted){return delete this[i]}})};global.spriteArray=SpriteArray})(this);if(typeof module!=="undefined"){module.exports=this.spriteArray}},{}],14:[function(require,module,exports){require("./lib/canvasRenderingContext2DExtensions");require("./lib/extenders");require("./lib/plugins");var Mousetrap=require("br-mousetrap");var isMobileDevice=require("./lib/isMobileDevice");var SpriteArray=require("./lib/spriteArray");var Monster=require("./lib/monster");var Sprite=require("./lib/sprite");var Snowboarder=require("./lib/snowboarder");var Skier=require("./lib/skier");var InfoBox=require("./lib/infoBox");var Game=require("./lib/game");var mainCanvas=document.getElementById("skifree-canvas");var dContext=mainCanvas.getContext("2d");var imageSources=["sprite-characters.png","skifree-objects.png"];var global=this;var infoBoxControls="Use the mouse or WASD to control the player";if(isMobileDevice())infoBoxControls="Tap or drag on the piste to control the player";var sprites=require("./spriteInfo");var pixelsPerMetre=18;var distanceTravelledInMetres=0;var monsterDistanceThreshold=2e3;var livesLeft=5;var highScore=0;var loseLifeOnObstacleHit=false;var dropRates={smallTree:4,tallTree:2,jump:1,thickSnow:1,rock:1};if(localStorage.getItem("highScore"))highScore=localStorage.getItem("highScore");function loadImages(sources,next){var loaded=0;var images={};function finish(){loaded+=1;if(loaded===sources.length){next(images)}}sources.each(function(src){var im=new Image;im.onload=finish;im.src=src;dContext.storeLoadedImage(src,im)})}function monsterHitsSkierBehaviour(monster,skier){skier.isEatenBy(monster,function(){livesLeft-=1;monster.isFull=true;monster.isEating=false;skier.isBeingEaten=false;monster.setSpeed(skier.getSpeed());monster.stopFollowing();var randomPositionAbove=dContext.getRandomMapPositionAboveViewport();monster.setMapPositionTarget(randomPositionAbove[0],randomPositionAbove[1])})}function startNeverEndingGame(images){var player;var startSign;var infoBox;var game;function resetGame(){distanceTravelledInMetres=0;livesLeft=5;highScore=localStorage.getItem("highScore");game.reset();game.addStaticObject(startSign)}function detectEnd(){if(!game.isPaused()){highScore=localStorage.setItem("highScore",distanceTravelledInMetres);infoBox.setLines(["Game over!","Hit space to restart"]);game.pause();game.cycle()}}function randomlySpawnNPC(spawnFunction,dropRate){var rateModifier=Math.max(800-mainCanvas.width,0);if(Number.random(1e3+rateModifier)<=dropRate){spawnFunction()}}function spawnMonster(){var newMonster=new Monster(sprites.monster);var randomPosition=dContext.getRandomMapPositionAboveViewport();newMonster.setMapPosition(randomPosition[0],randomPosition[1]);newMonster.follow(player);newMonster.setSpeed(player.getStandardSpeed());newMonster.onHitting(player,monsterHitsSkierBehaviour);game.addMovingObject(newMonster,"monster")}function spawnBoarder(){var newBoarder=new Snowboarder(sprites.snowboarder);var randomPositionAbove=dContext.getRandomMapPositionAboveViewport();var randomPositionBelow=dContext.getRandomMapPositionBelowViewport();newBoarder.setMapPosition(randomPositionAbove[0],randomPositionAbove[1]);newBoarder.setMapPositionTarget(randomPositionBelow[0],randomPositionBelow[1]);newBoarder.onHitting(player,sprites.snowboarder.hitBehaviour.skier);game.addMovingObject(newBoarder)}player=new Skier(sprites.skier);player.setMapPosition(0,0);player.setMapPositionTarget(0,-10);if(loseLifeOnObstacleHit){player.setHitObstacleCb(function(){livesLeft-=1})}game=new Game(mainCanvas,player);startSign=new Sprite(sprites.signStart);game.addStaticObject(startSign);startSign.setMapPosition(-50,0);dContext.followSprite(player);infoBox=new InfoBox({initialLines:["SkiFree.js",infoBoxControls,"Travelled 0m","High Score: "+highScore,"Skiers left: "+livesLeft,"Created by Dan Hough (@basicallydan)"],position:{top:15,right:10}});game.beforeCycle(function(){var newObjects=[];if(player.isMoving){newObjects=Sprite.createObjects([{sprite:sprites.smallTree,dropRate:dropRates.smallTree},{sprite:sprites.tallTree,dropRate:dropRates.tallTree},{sprite:sprites.jump,dropRate:dropRates.jump},{sprite:sprites.thickSnow,dropRate:dropRates.thickSnow},{sprite:sprites.rock,dropRate:dropRates.rock}],{rateModifier:Math.max(800-mainCanvas.width,0),position:function(){return dContext.getRandomMapPositionBelowViewport()},player:player})}if(!game.isPaused()){game.addStaticObjects(newObjects);randomlySpawnNPC(spawnBoarder,.1);distanceTravelledInMetres=parseFloat(player.getPixelsTravelledDownMountain()/pixelsPerMetre).toFixed(1);if(distanceTravelledInMetres>monsterDistanceThreshold){randomlySpawnNPC(spawnMonster,.001)}infoBox.setLines(["SkiFree.js",infoBoxControls,"Travelled "+distanceTravelledInMetres+"m","Skiers left: "+livesLeft,"High Score: "+highScore,"Created by Dan Hough (@basicallydan)","Current Speed: "+player.getSpeed()])}});game.afterCycle(function(){if(livesLeft===0){detectEnd()}});game.addUIElement(infoBox);Mousetrap.bind("f",player.speedBoost);Mousetrap.bind("t",player.attemptTrick);Mousetrap.bind(["w","up"],function(){player.stop()});Mousetrap.bind(["a","left"],function(){if(player.direction===270){player.stepWest()}else{player.turnWest()}});Mousetrap.bind(["s","down"],function(){player.setDirection(180);player.startMovingIfPossible()});Mousetrap.bind(["d","right"],function(){if(player.direction===90){player.stepEast()}else{player.turnEast()}});Mousetrap.bind("m",spawnMonster);Mousetrap.bind("b",spawnBoarder);Mousetrap.bind("space",resetGame);player.isMoving=false;player.setDirection(270);var cionic=new cionicjs.Cionic({streamLogger:function(msg,cls){var logDiv=document.getElementById("log");logDiv.innerHTML+='<div class="'+cls+'">&gt;&nbsp;'+msg+"</div>";logDiv.scrollTop=logDiv.scrollHeight}});cionic.Stream.registerListener("lPress",function(isPressed){if(isPressed==="ON"){if(player.direction===270){player.stepWest()}else{player.turnWest()}}});cionic.Stream.registerListener("rPress",function(isPressed){if(isPressed==="ON"){if(player.direction===90){player.stepEast()}else{player.turnEast()}}});cionic.Stream.registerListener("uPress",function(isPressed){if(isPressed==="ON")player.stop()});cionic.Stream.registerListener("dPress",function(isPressed){if(isPressed==="ON"){player.setDirection(180);player.startMovingIfPossible()}});document.getElementById("cionic-connect").onclick=function(){var host=document.getElementById("host").value;cionic.Stream.socket(host)};var isRecording=false;var canvas=document.querySelector("canvas");var recordButton=document.querySelector("button#record");var downloadButton=document.querySelector("button#download");var canvasRecorder=new cionicjs.CanvasRecorder({canvas:canvas,recordButton:recordButton,downloadButton:downloadButton});recordButton.onclick=function(){if(!isRecording){canvasRecorder.startRecording();recordButton.textContent="Stop Recording";downloadButton.disabled=true;isRecording=true}else{canvasRecorder.stopRecording();recordButton.textContent="Start Recording";downloadButton.disabled=false;isRecording=false}};downloadButton.onclick=function(){var fn=Math.random().toString(36).substring(2,8);canvasRecorder.download(fn)};var monitorAPI=new cionicjs.MonitorAPI({verbose:false});monitorAPI.addPlayer(cionic);monitorAPI.main();game.start()}function resizeCanvas(){mainCanvas.width=window.innerWidth;mainCanvas.height=window.innerHeight}window.addEventListener("resize",resizeCanvas,false);resizeCanvas();loadImages(imageSources,startNeverEndingGame);this.exports=window},{"./lib/canvasRenderingContext2DExtensions":2,"./lib/extenders":3,"./lib/game":4,"./lib/infoBox":6,"./lib/isMobileDevice":7,"./lib/monster":8,"./lib/plugins":9,"./lib/skier":10,"./lib/snowboarder":11,"./lib/sprite":12,"./lib/spriteArray":13,"./spriteInfo":15,"br-mousetrap":16}],15:[function(require,module,exports){(function(global){var sprites={skier:{$imageFile:"sprite-characters.png",parts:{blank:[0,0,0,0],east:[0,0,24,34],esEast:[24,0,24,34],sEast:[49,0,17,34],south:[65,0,17,34],sWest:[49,37,17,34],wsWest:[24,37,24,34],west:[0,37,24,34],hit:[0,78,31,31],jumping:[84,0,32,34],somersault1:[116,0,32,34],somersault2:[148,0,32,34]},hitBoxes:{0:[7,20,27,34]},id:"player",hitBehaviour:{}},smallTree:{$imageFile:"skifree-objects.png",parts:{main:[0,28,30,34]},hitBoxes:{0:[0,18,30,34]},hitBehaviour:{}},tallTree:{$imageFile:"skifree-objects.png",parts:{main:[95,66,32,64]},zIndexesOccupied:[0,1],hitBoxes:{0:[0,54,32,64],1:[0,10,32,54]},hitBehaviour:{}},thickSnow:{$imageFile:"skifree-objects.png",parts:{main:[143,53,43,10]},hitBehaviour:{}},rock:{$imageFile:"skifree-objects.png",parts:{main:[30,52,23,11]},hitBehaviour:{}},monster:{$imageFile:"sprite-characters.png",parts:{sEast1:[64,112,26,43],sEast2:[90,112,32,43],sWest1:[64,158,26,43],sWest2:[90,158,32,43],eating1:[122,112,34,43],eating2:[156,112,31,43],eating3:[187,112,31,43],eating4:[219,112,25,43],eating5:[243,112,26,43]},hitBehaviour:{}},jump:{$imageFile:"skifree-objects.png",parts:{main:[109,55,32,8]},hitBehaviour:{}},signStart:{$imageFile:"skifree-objects.png",parts:{main:[260,103,42,27]},hitBehaviour:{}},snowboarder:{$imageFile:"sprite-characters.png",parts:{sEast:[73,229,20,29],sWest:[95,228,26,30]},hitBehaviour:{}},emptyChairLift:{$imageFile:"skifree-objects.png",parts:{main:[92,136,26,30]},zIndexesOccupied:[1]}};function monsterHitsTreeBehaviour(monster){monster.deleteOnNextCycle()}sprites.monster.hitBehaviour.tree=monsterHitsTreeBehaviour;function treeHitsMonsterBehaviour(tree,monster){monster.deleteOnNextCycle()}sprites.smallTree.hitBehaviour.monster=treeHitsMonsterBehaviour;sprites.tallTree.hitBehaviour.monster=treeHitsMonsterBehaviour;function skierHitsTreeBehaviour(skier,tree){skier.hasHitObstacle(tree)}function treeHitsSkierBehaviour(tree,skier){skier.hasHitObstacle(tree)}sprites.smallTree.hitBehaviour.skier=treeHitsSkierBehaviour;sprites.tallTree.hitBehaviour.skier=treeHitsSkierBehaviour;function rockHitsSkierBehaviour(rock,skier){skier.hasHitObstacle(rock)}sprites.rock.hitBehaviour.skier=rockHitsSkierBehaviour;function skierHitsJumpBehaviour(skier,jump){skier.hasHitJump(jump)}function jumpHitsSkierBehaviour(jump,skier){skier.hasHitJump(jump)}sprites.jump.hitBehaviour.skier=jumpHitsSkierBehaviour;function snowboarderHitsSkierBehaviour(snowboarder,skier){skier.hasHitObstacle(snowboarder)}sprites.snowboarder.hitBehaviour.skier=snowboarderHitsSkierBehaviour;global.spriteInfo=sprites})(this);if(typeof module!=="undefined"){module.exports=this.spriteInfo}},{}],16:[function(require,module,exports){(function(){var _MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc"},_REVERSE_MAP,_callbacks={},_direct_map={},_sequence_levels={},_reset_timer,_ignore_next_keyup=false,_inside_sequence=false;for(var i=1;i<20;++i){_MAP[111+i]="f"+i}for(i=0;i<=9;++i){_MAP[i+96]=i}function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return}object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if(e.type=="keypress"){return String.fromCharCode(e.which)}if(_MAP[e.which]){return _MAP[e.which]}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which]}return String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _resetSequences(do_not_reset){do_not_reset=do_not_reset||{};var active_sequences=false,key;for(key in _sequence_levels){if(do_not_reset[key]){active_sequences=true;continue}_sequence_levels[key]=0}if(!active_sequences){_inside_sequence=false}}function _getMatches(character,modifiers,e,remove,combination){var i,callback,matches=[],action=e.type;if(!_callbacks[character]){return[]}if(action=="keyup"&&_isModifier(character)){modifiers=[character]}for(i=0;i<_callbacks[character].length;++i){callback=_callbacks[character][i];if(callback.seq&&_sequence_levels[callback.seq]!=callback.level){continue}if(action!=callback.action){continue}if(action=="keypress"&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers)){if(remove&&callback.combo==combination){_callbacks[character].splice(i,1)}matches.push(callback)}}return matches}function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push("shift")}if(e.altKey){modifiers.push("alt")}if(e.ctrlKey){modifiers.push("ctrl")}if(e.metaKey){modifiers.push("meta")}return modifiers}function _fireCallback(callback,e){if(callback(e)===false){if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}e.returnValue=false;e.cancelBubble=true}}function _handleCharacter(character,e){if(Mousetrap.stopCallback(e,e.target||e.srcElement)){return}var callbacks=_getMatches(character,_eventModifiers(e),e),i,do_not_reset={},processed_sequence_callback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){processed_sequence_callback=true;do_not_reset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e);continue}if(!processed_sequence_callback&&!_inside_sequence){_fireCallback(callbacks[i].callback,e)}}if(e.type==_inside_sequence&&!_isModifier(character)){_resetSequences(do_not_reset)}}function _handleKey(e){e.which=typeof e.which=="number"?e.which:e.keyCode;var character=_characterFromEvent(e);if(!character){return}if(e.type=="keyup"&&_ignore_next_keyup==character){_ignore_next_keyup=false;return}_handleCharacter(character,e)}function _isModifier(key){return key=="shift"||key=="ctrl"||key=="alt"||key=="meta"}function _resetSequenceTimer(){clearTimeout(_reset_timer);_reset_timer=setTimeout(_resetSequences,1e3)}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue}if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key}}}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?"keydown":"keypress"}if(action=="keypress"&&modifiers.length){action="keydown"}return action}function _bindSequence(combo,keys,callback,action){_sequence_levels[combo]=0;if(!action){action=_pickBestAction(keys[0],[])}var _increaseSequence=function(e){_inside_sequence=action;++_sequence_levels[combo];_resetSequenceTimer()},_callbackAndReset=function(e){_fireCallback(callback,e);if(action!=="keyup"){_ignore_next_keyup=_characterFromEvent(e)}setTimeout(_resetSequences,10)},i;for(i=0;i<keys.length;++i){_bindSingle(keys[i],i<keys.length-1?_increaseSequence:_callbackAndReset,action,combo,i)}}function _bindSingle(combination,callback,action,sequence_name,level){combination=combination.replace(/\s+/g," ");var sequence=combination.split(" "),i,key,keys,modifiers=[];if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return}keys=combination==="+"?["+"]:combination.split("+");for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key]}if(action&&action!="keypress"&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}if(_isModifier(key)){modifiers.push(key)}}action=_pickBestAction(key,modifiers,action);if(!_callbacks[key]){_callbacks[key]=[]}_getMatches(key,modifiers,{type:action},!sequence_name,combination);_callbacks[key][sequence_name?"unshift":"push"]({callback:callback,modifiers:modifiers,action:action,seq:sequence_name,level:level,combo:combination})}function _bindMultiple(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action)}}_addEvent(document,"keypress",_handleKey);_addEvent(document,"keydown",_handleKey);_addEvent(document,"keyup",_handleKey);var Mousetrap={bind:function(keys,callback,action){_bindMultiple(keys instanceof Array?keys:[keys],callback,action);_direct_map[keys+":"+action]=callback;return this},unbind:function(keys,action){if(_direct_map[keys+":"+action]){delete _direct_map[keys+":"+action];this.bind(keys,function(){},action)}return this},trigger:function(keys,action){_direct_map[keys+":"+action]();return this},reset:function(){_callbacks={};_direct_map={};return this},stopCallback:function(e,element){if((" "+element.className+" ").indexOf(" mousetrap ")>-1){return false}return element.tagName=="INPUT"||element.tagName=="SELECT"||element.tagName=="TEXTAREA"||element.contentEditable&&element.contentEditable=="true"}};window.Mousetrap=Mousetrap;if(typeof define=="function"&&define.amd){define("mousetrap",function(){return Mousetrap})}if(typeof module==="object"&&module.exports){module.exports=Mousetrap}})()},{}],17:[function(require,module,exports){(function(global){(function(){var root=this;var EventEmitter=require("events").EventEmitter;var _=require("underscore");var intervalParser=/([0-9\.]+)(ms|s|m|h)?/;var root=global||window;if(typeof Function.prototype.inherits==="undefined"){Function.prototype.inherits=function(parent){this.prototype=Object.create(parent.prototype)}}if(typeof Array.prototype.removeOne==="undefined"){Array.prototype.removeOne=function(){var what,a=arguments,L=a.length,ax;while(L&&this.length){what=a[--L];while((ax=this.indexOf(what))!==-1){return this.splice(ax,1)}}}}function greatestCommonFactor(intervals){var sumOfModuli=1;var interval=_.min(intervals);while(sumOfModuli!==0){sumOfModuli=_.reduce(intervals,function(memo,i){return memo+i%interval},0);if(sumOfModuli!==0){interval-=10}}return interval}function parseEvent(e){var intervalGroups=intervalParser.exec(e);if(!intervalGroups){throw new Error("I don't understand that particular interval")}var intervalAmount=+intervalGroups[1];var intervalType=intervalGroups[2]||"ms";if(intervalType==="s"){intervalAmount=intervalAmount*1e3}else if(intervalType==="m"){intervalAmount=intervalAmount*1e3*60}else if(intervalType==="h"){intervalAmount=intervalAmount*1e3*60*60}else if(!!intervalType&&intervalType!=="ms"){throw new Error("You can only specify intervals of ms, s, m, or h")}if(intervalAmount<10||intervalAmount%10!==0){throw new Error("You can only specify 10s of milliseconds, trust me on this one")}return{amount:intervalAmount,type:intervalType}}function EventedLoop(){this.intervalId=undefined;this.intervalLength=undefined;this.intervalsToEmit={};this.currentTick=1;this.maxTicks=0;this.listeningForFocus=false;var determineIntervalLength=function(){var potentialIntervalLength=greatestCommonFactor(_.keys(this.intervalsToEmit));var changed=false;if(this.intervalLength){if(potentialIntervalLength!==this.intervalLength){this.intervalLength=potentialIntervalLength;changed=true}}else{this.intervalLength=potentialIntervalLength}this.maxTicks=_.max(_.map(_.keys(this.intervalsToEmit),function(a){return+a}))/this.intervalLength;return changed}.bind(this);this.on("newListener",function(e){if(e==="removeListener"||e==="newListener")return;var intervalInfo=parseEvent(e);var intervalAmount=intervalInfo.amount;this.intervalsToEmit[+intervalAmount]=_.union(this.intervalsToEmit[+intervalAmount]||[],[e]);if(determineIntervalLength()&&this.isStarted()){this.stop().start()}});this.on("removeListener",function(e){if(EventEmitter.listenerCount(this,e)>0)return;var intervalInfo=parseEvent(e);var intervalAmount=intervalInfo.amount;var removedEvent=this.intervalsToEmit[+intervalAmount].removeOne(e);if(this.intervalsToEmit[+intervalAmount].length===0){delete this.intervalsToEmit[+intervalAmount]}console.log("Determining interval length after removal of",removedEvent);determineIntervalLength();if(determineIntervalLength()&&this.isStarted()){this.stop().start()}})}EventedLoop.inherits(EventEmitter);EventedLoop.prototype.tick=function(){var milliseconds=this.currentTick*this.intervalLength;_.each(this.intervalsToEmit,function(events,key){if(milliseconds%key===0){_.each(events,function(e){this.emit(e,e,key)}.bind(this))}}.bind(this));this.currentTick+=1;if(this.currentTick>this.maxTicks){this.currentTick=1}return this};EventedLoop.prototype.start=function(){if(!this.intervalLength){throw new Error("You haven't specified any interval callbacks. Use EventedLoop.on('500ms', function () { ... }) to do so, and then you can start")}if(this.intervalId){return console.log("No need to start the loop again, it's already started.")}this.intervalId=setInterval(this.tick.bind(this),this.intervalLength);if(root&&!this.listeningForFocus&&root.addEventListener){root.addEventListener("focus",function(){this.start()}.bind(this));root.addEventListener("blur",function(){this.stop()}.bind(this));this.listeningForFocus=true}return this};EventedLoop.prototype.stop=function(){clearInterval(this.intervalId);this.intervalId=undefined;return this};EventedLoop.prototype.isStarted=function(){return!!this.intervalId};EventedLoop.prototype.every=EventedLoop.prototype.on;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=EventedLoop}exports.EventedLoop=EventedLoop}if(typeof window!=="undefined"){window.EventedLoop=EventedLoop}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{events:1,underscore:18}],18:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return obj;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return}}return obj};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,predicate,context){var result;any(obj,function(value,index,list){if(predicate.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(predicate,context);each(obj,function(value,index,list){if(predicate.call(context,value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)};_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(predicate,context);each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(predicate,context);each(obj,function(value,index,list){if(result||(result=predicate.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}var result=-Infinity,lastComputed=-Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed>lastComputed){result=value;lastComputed=computed}});return result};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}var result=Infinity,lastComputed=Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed<lastComputed){result=value;lastComputed=computed}});return result};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){if(value==null)return _.identity;if(_.isFunction(value))return value;return _.property(value)};_.sortBy=function(obj,iterator,context){iterator=lookupIterator(iterator);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};iterator=lookupIterator(iterator);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]});_.indexBy=group(function(result,key,value){result[key]=value});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1});_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.partition=function(array,predicate){var pass=[],fail=[];each(array,function(elem){(predicate(elem)?pass:fail).push(elem)});return[pass,fail]};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,length+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++]}while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args)}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait)}if(callNow){result=func.apply(context,args);context=args=null}return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){return function(obj){if(obj===attrs)return true;for(var key in attrs){if(attrs[key]!==obj[key])return false}return true}};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}});if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}]},{},[14]);
